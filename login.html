<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Login (debug)</title>
<style>
  body{font-family:Segoe UI,Arial;margin:0;display:flex;align-items:center;justify-content:center;height:100vh;background:#f0f4f8}
  .box{background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.08);width:320px}
  input{width:100%;padding:10px;margin:8px 0;border:1px solid #ddd;border-radius:8px}
  button{width:100%;padding:10px;background:#2563eb;color:#fff;border:none;border-radius:8px;cursor:pointer}
  pre#dbg{height:120px;overflow:auto;background:#0b1220;color:#dff; padding:8px;border-radius:6px;font-size:12px}
</style>
</head>
<body>
  <div class="box">
    <h3 id="title">ÄÄƒng nháº­p (debug)</h3>
    <input id="username" placeholder="username"/>
    <input id="password" type="password" placeholder="password"/>
    <button id="act">ÄÄƒng nháº­p/ÄÄƒng kÃ½</button>
    <p style="font-size:12px;color:#666;margin-top:8px">(Ghi chÃº: login sáº½ lÆ°u vÃ o localStorage keys: users, user)</p>
    <pre id="dbg">Console debug output...</pre>
  </div>

<script>
const dbg = msg => {
  console.log(msg);
  const p = document.getElementById('dbg');
  p.textContent = msg + "\n" + p.textContent;
}

dbg('Script loaded, location: ' + window.location.href);
dbg('origin: ' + window.location.origin + ' , pathname: ' + window.location.pathname);

const act = document.getElementById('act');
act.addEventListener('click', async ()=> {
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value.trim();
  if(!u || !p) return alert('Nháº­p Ä‘á»§ thÃ´ng tin');

  // read users
  let users = JSON.parse(localStorage.getItem('users') || '[]');
  let found = users.find(x=>x.username===u && x.password===p);

  if(found) {
    localStorage.setItem('user', JSON.stringify(found));
    dbg('ÄÄƒng nháº­p OK, user saved to localStorage.user');
    // try several redirect methods, log each
    try {
      dbg('Attempting window.location.href = "index.html"');
      window.location.href = 'index.html';
      // if browser doesn't navigate immediately we still try assign/open after small delay
      await new Promise(r=>setTimeout(r,600));
    } catch(e){ dbg('href error: '+e) }

    try {
      dbg('Attempting window.location.assign(...)');
      window.location.assign(window.location.origin + window.location.pathname.replace(/\/login\.html$/,'/index.html'));
      await new Promise(r=>setTimeout(r,600));
    } catch(e){ dbg('assign error: '+e) }

    try {
      dbg('Attempting window.open("index.html","_self")');
      window.open('index.html','_self');
      await new Promise(r=>setTimeout(r,600));
    } catch(e){ dbg('open error: '+e) }

    // final absolute fallback
    const abs = window.location.origin + (window.location.pathname.includes('/') ? window.location.pathname.replace(/login\.html$/,'index.html') : '/index.html');
    dbg('Final fallback to absolute: ' + abs);
    window.location.replace(abs);
  } else {
    // register quick if username not exists
    if(users.some(x=>x.username===u)) {
      alert('Sai tÃªn hoáº·c máº­t kháº©u.');
      dbg('Login failed: wrong password');
      return;
    }
    users.push({username:u,password:p});
    localStorage.setItem('users', JSON.stringify(users));
    alert('ÄÄƒng kÃ½ thÃ nh cÃ´ng, giá» nháº¥n Ä‘Äƒng nháº­p vá»›i cÃ¹ng thÃ´ng tin.');
    dbg('Registered new user: '+u);
  }
});
<script>
(function() {
  // Táº¡o khung hiá»ƒn thá»‹ log
  const debugBox = document.createElement("div");
  debugBox.id = "debugBox";
  debugBox.style.position = "fixed";
  debugBox.style.bottom = "0";
  debugBox.style.left = "0";
  debugBox.style.width = "100%";
  debugBox.style.maxHeight = "40vh";
  debugBox.style.overflowY = "auto";
  debugBox.style.background = "rgba(0,0,0,0.85)";
  debugBox.style.color = "#0f0";
  debugBox.style.fontFamily = "monospace";
  debugBox.style.fontSize = "12px";
  debugBox.style.padding = "10px";
  debugBox.style.zIndex = "99999";
  debugBox.innerHTML = "<b>ğŸ“‹ Debug console:</b><br>";
  document.body.appendChild(debugBox);

  function log(msg) {
    debugBox.innerHTML += msg + "<br>";
  }

  // Ghi Ä‘Ã¨ console.log
  console.log = function(msg) {
    log("LOG: " + msg);
  };

  // Ghi lá»—i JS
  window.addEventListener("error", (e) => {
    log("âŒ ERROR: " + e.message + " at " + e.filename + ":" + e.lineno);
  });

  // Log sá»± kiá»‡n khi ngÆ°á»i dÃ¹ng báº¥m nÃºt
  log("âœ… Debug console Ä‘Ã£ sáºµn sÃ ng!");
})();
</script>
</script>
</script>
</script>
</body>
</html>
