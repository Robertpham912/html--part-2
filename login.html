<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Login (debug)</title>
<style>
  body{font-family:Segoe UI,Arial;margin:0;display:flex;align-items:center;justify-content:center;height:100vh;background:#f0f4f8}
  .box{background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.08);width:320px}
  input{width:100%;padding:10px;margin:8px 0;border:1px solid #ddd;border-radius:8px}
  button{width:100%;padding:10px;background:#2563eb;color:#fff;border:none;border-radius:8px;cursor:pointer}
  pre#dbg{height:120px;overflow:auto;background:#0b1220;color:#dff; padding:8px;border-radius:6px;font-size:12px}
</style>
</head>
<body>
  <div class="box">
    <h3 id="title">Đăng nhập (debug)</h3>
    <input id="username" placeholder="username"/>
    <input id="password" type="password" placeholder="password"/>
    <button id="act">Đăng nhập/Đăng ký</button>
    <p style="font-size:12px;color:#666;margin-top:8px">(Ghi chú: login sẽ lưu vào localStorage keys: users, user)</p>
    <pre id="dbg">Console debug output...</pre>
  </div>

<script>
const dbg = msg => {
  console.log(msg);
  const p = document.getElementById('dbg');
  p.textContent = msg + "\n" + p.textContent;
}

dbg('Script loaded, location: ' + window.location.href);
dbg('origin: ' + window.location.origin + ' , pathname: ' + window.location.pathname);

const act = document.getElementById('act');
act.addEventListener('click', async ()=> {
  const u = document.getElementById('username').value.trim();
  const p = document.getElementById('password').value.trim();
  if(!u || !p) return alert('Nhập đủ thông tin');

  // read users
  let users = JSON.parse(localStorage.getItem('users') || '[]');
  let found = users.find(x=>x.username===u && x.password===p);

  if(found) {
    localStorage.setItem('user', JSON.stringify(found));
    dbg('Đăng nhập OK, user saved to localStorage.user');
    // try several redirect methods, log each
    try {
      dbg('Attempting window.location.href = "index.html"');
      window.location.href = 'index.html';
      // if browser doesn't navigate immediately we still try assign/open after small delay
      await new Promise(r=>setTimeout(r,600));
    } catch(e){ dbg('href error: '+e) }

    try {
      dbg('Attempting window.location.assign(...)');
      window.location.assign(window.location.origin + window.location.pathname.replace(/\/login\.html$/,'/index.html'));
      await new Promise(r=>setTimeout(r,600));
    } catch(e){ dbg('assign error: '+e) }

    try {
      dbg('Attempting window.open("index.html","_self")');
      window.open('index.html','_self');
      await new Promise(r=>setTimeout(r,600));
    } catch(e){ dbg('open error: '+e) }

    // final absolute fallback
    const abs = window.location.origin + (window.location.pathname.includes('/') ? window.location.pathname.replace(/login\.html$/,'index.html') : '/index.html');
    dbg('Final fallback to absolute: ' + abs);
    window.location.replace(abs);
  } else {
    // register quick if username not exists
    if(users.some(x=>x.username===u)) {
      alert('Sai tên hoặc mật khẩu.');
      dbg('Login failed: wrong password');
      return;
    }
    users.push({username:u,password:p});
    localStorage.setItem('users', JSON.stringify(users));
    alert('Đăng ký thành công, giờ nhấn đăng nhập với cùng thông tin.');
    dbg('Registered new user: '+u);
  }
});
<script>
window.addEventListener("error", (e) => {
  const box = document.createElement("div");
  box.style.position = "fixed";
  box.style.bottom = "10px";
  box.style.left = "10px";
  box.style.background = "rgba(0,0,0,0.8)";
  box.style.color = "white";
  box.style.padding = "10px";
  box.style.borderRadius = "6px";
  box.style.fontSize = "12px";
  box.style.maxWidth = "300px";
  box.style.zIndex = "9999";
  box.innerText = "Lỗi: " + e.message;
  document.body.appendChild(box);
});
console.log("Script loaded, location:", window.location.href);
  <script>
// Hàm hiển thị log ngay trên trang
function showLog(message) {
  const box = document.getElementById("logBox") || (() => {
    const b = document.createElement("div");
    b.id = "logBox";
    b.style.position = "fixed";
    b.style.bottom = "10px";
    b.style.left = "10px";
    b.style.background = "rgba(0,0,0,0.75)";
    b.style.color = "#0f0";
    b.style.padding = "10px";
    b.style.borderRadius = "6px";
    b.style.fontFamily = "monospace";
    b.style.fontSize = "12px";
    b.style.maxWidth = "90%";
    b.style.zIndex = "9999";
    document.body.appendChild(b);
    return b;
  })();
  box.innerHTML += message + "<br>";
  console.log(message);
}

// Thay console.log = showLog
console.log = showLog;

// Log thử để xem hoạt động
console.log("✅ Console hiển thị trực tiếp trên web!");

window.addEventListener("error", (e) => {
  showLog("❌ Lỗi: " + e.message);
});
</script>
</script>
</script>
</body>
</html>
